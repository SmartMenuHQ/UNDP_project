<% content_for :title, "Preview: #{@assessment.title}" %>

<div class="space-y-8">
  <!-- Assessment Header -->
  <div class="text-center">
    <h1 class="text-3xl font-bold text-gray-900 mb-4"><%= @assessment.title %></h1>
    <% if @assessment.description.present? %>
      <p class="text-lg text-gray-600 max-w-2xl mx-auto"><%= @assessment.description %></p>
    <% end %>
  </div>

  <!-- Assessment Progress -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
    <div class="flex items-center justify-between text-sm text-gray-600">
      <span>Progress</span>
      <span>
        <% if @sections.any? %>
          Section <%= @current_section_index + 1 %> of <%= @sections.count %> â€¢
          <%= @current_section&.total_questions || 0 %> questions in this section
        <% else %>
          No sections available
        <% end %>
      </span>
    </div>
    <div class="mt-2 bg-gray-200 rounded-full h-2">
      <% if @sections.any? %>
        <% progress = ((@current_section_index + 1).to_f / @sections.count * 100).round %>
        <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: <%= progress %>%"></div>
      <% else %>
        <div class="bg-blue-600 h-2 rounded-full" style="width: 0%"></div>
      <% end %>
    </div>
  </div>

  <!-- Current Section -->
  <% if @current_section %>
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
      <!-- Section Header -->
      <div class="bg-gray-50 px-6 py-4 border-b border-gray-200">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
              <span class="text-sm font-medium text-blue-600"><%= @current_section.order %></span>
            </div>
            <div>
              <h2 class="text-xl font-semibold text-gray-900"><%= @current_section.display_name %></h2>
              <p class="text-sm text-gray-600">
                <%= pluralize(@current_section.total_questions, 'question') %>
              </p>
            </div>
          </div>
          <div class="text-sm text-gray-500">
            Section <%= @current_section_index + 1 %> of <%= @sections.count %>
          </div>
        </div>
      </div>

      <!-- Section Questions -->
      <div class="divide-y divide-gray-200">
        <% @current_section.assessment_questions.ordered.each_with_index do |question, question_index| %>
          <div class="p-6">
            <div class="flex items-start space-x-4">
              <div class="flex-shrink-0 w-6 h-6 bg-<%= question.question_type_color %>-100 rounded-full flex items-center justify-center mt-1">
                <span class="text-xs font-medium text-<%= question.question_type_color %>-600">
                  <%= question.order %>
                </span>
              </div>
              <div class="flex-1">
                <div class="flex items-center space-x-2 mb-3">
                  <h3 class="text-lg font-medium text-gray-900"><%= question.display_text %></h3>
                  <% if question.is_required? %>
                    <span class="text-red-500 text-sm">*</span>
                  <% end %>
                  <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-<%= question.question_type_color %>-100 text-<%= question.question_type_color %>-800">
                    <%= question.question_type_name %>
                  </span>
                </div>

                <!-- Question Input Based on Type -->
                <div class="mt-4">
                  <% case question.type %>
                  <% when 'AssessmentQuestions::MultipleChoice' %>
                    <div class="space-y-2">
                      <% if question.respond_to?(:option) && question.option.any? %>
                        <% question.option.ordered.each do |option| %>
                          <label class="flex items-center space-x-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer">
                            <input type="checkbox" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500" disabled>
                            <span class="text-gray-700"><%= option.text %></span>
                          </label>
                        <% end %>
                      <% else %>
                        <div class="text-gray-500 italic p-2 bg-gray-50 rounded-lg">No options configured</div>
                      <% end %>
                    </div>

                  <% when 'AssessmentQuestions::Radio' %>
                    <div class="space-y-2">
                      <% if question.respond_to?(:option) && question.option.any? %>
                        <% question.option.ordered.each do |option| %>
                          <label class="flex items-center space-x-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="question_<%= question.id %>" class="border-gray-300 text-blue-600 focus:ring-blue-500" disabled>
                            <span class="text-gray-700"><%= option.text %></span>
                          </label>
                        <% end %>
                      <% else %>
                        <div class="text-gray-500 italic p-2 bg-gray-50 rounded-lg">No options configured</div>
                      <% end %>
                    </div>

                  <% when 'AssessmentQuestions::BooleanType' %>
                    <div class="space-y-2">
                      <% if question.respond_to?(:option) && question.option.any? %>
                        <% question.option.ordered.each do |option| %>
                          <label class="flex items-center space-x-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="question_<%= question.id %>" class="border-gray-300 text-blue-600 focus:ring-blue-500" disabled>
                            <span class="text-gray-700"><%= option.text %></span>
                          </label>
                        <% end %>
                      <% else %>
                        <div class="space-y-2">
                          <label class="flex items-center space-x-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="question_<%= question.id %>" class="border-gray-300 text-blue-600 focus:ring-blue-500" disabled>
                            <span class="text-gray-700">Yes</span>
                          </label>
                          <label class="flex items-center space-x-3 p-2 rounded-lg hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="question_<%= question.id %>" class="border-gray-300 text-blue-600 focus:ring-blue-500" disabled>
                            <span class="text-gray-700">No</span>
                          </label>
                        </div>
                      <% end %>
                    </div>

                  <% when 'AssessmentQuestions::DateType' %>
                    <input type="date" class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" disabled>

                  <% when 'AssessmentQuestions::RangeType' %>
                    <div class="space-y-4">
                      <input type="range" min="1" max="10" value="5" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider" disabled>
                      <div class="flex justify-between text-sm text-gray-500">
                        <span>1</span>
                        <span>5</span>
                        <span>10</span>
                      </div>
                    </div>

                  <% when 'AssessmentQuestions::RichText' %>
                    <textarea rows="4" class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="Enter your response here..." disabled></textarea>

                  <% when 'AssessmentQuestions::FileUpload' %>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                      <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                      </svg>
                      <div class="mt-4">
                        <p class="text-sm text-gray-600">Upload a file</p>
                        <% if question.respond_to?(:max_file_size_human) %>
                          <p class="text-xs text-gray-500 mt-1">Maximum file size: <%= question.max_file_size_human %></p>
                        <% end %>
                        <% if question.respond_to?(:allowed_extensions) %>
                          <p class="text-xs text-gray-500">Allowed formats: <%= question.allowed_extensions %></p>
                        <% end %>
                      </div>
                    </div>

                  <% else %>
                    <div class="text-gray-500 italic p-2 bg-gray-50 rounded-lg">Unknown question type</div>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        <% end %>

        <% if @current_section.assessment_questions.empty? %>
          <div class="p-6 text-center text-gray-500">
            <svg class="w-12 h-12 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <p>No questions in this section yet</p>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- Section Navigation -->
  <% if @sections.any? %>
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <div class="flex justify-between items-center">
        <div class="flex space-x-3">
          <% if @has_previous %>
            <%= link_to preview_assessment_path(@assessment, section: @previous_section_index),
                class: "bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors inline-flex items-center" do %>
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
              Previous Section
            <% end %>
          <% else %>
            <span class="bg-gray-300 text-gray-500 px-4 py-2 rounded-md text-sm font-medium cursor-not-allowed inline-flex items-center">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
              Previous Section
            </span>
          <% end %>

          <%= link_to "Back to Edit", edit_assessment_path(@assessment),
              class: "bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors" %>
        </div>

        <div class="flex items-center space-x-4">
          <!-- Section Indicator -->
          <div class="flex items-center space-x-2">
            <% @sections.each_with_index do |section, index| %>
              <% if index == @current_section_index %>
                <span class="w-3 h-3 bg-blue-600 rounded-full"></span>
              <% else %>
                <%= link_to preview_assessment_path(@assessment, section: index),
                    class: "w-3 h-3 bg-gray-300 hover:bg-gray-400 rounded-full block transition-colors" do %>
                <% end %>
              <% end %>
            <% end %>
          </div>

          <div class="flex space-x-3">
            <% if @has_next %>
              <%= link_to preview_assessment_path(@assessment, section: @next_section_index),
                  class: "bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors inline-flex items-center" do %>
                Next Section
                <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              <% end %>
            <% else %>
              <span class="bg-green-600 text-white px-4 py-2 rounded-md text-sm font-medium cursor-not-allowed inline-flex items-center">
                Complete
                <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
              </span>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Empty State -->
  <% if @sections.empty? %>
    <div class="text-center py-12">
      <div class="mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-6">
        <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
      </div>
      <h3 class="text-lg font-medium text-gray-900 mb-2">No sections yet</h3>
      <p class="text-gray-600 mb-6">This assessment doesn't have any sections or questions yet.</p>
      <div class="space-x-4">
        <%= link_to "Edit Assessment", edit_assessment_path(@assessment),
            class: "bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg text-sm font-medium transition-colors" %>
      </div>
    </div>
  <% end %>
</div>

<style>
/* Custom slider styles */
.slider {
  -webkit-appearance: none;
  appearance: none;
  background: transparent;
  cursor: pointer;
}

.slider::-webkit-slider-track {
  background: #d1d5db;
  height: 8px;
  border-radius: 4px;
}

.slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  height: 20px;
  width: 20px;
  border-radius: 50%;
  background: #2563eb;
  cursor: pointer;
  margin-top: -6px;
}

.slider::-moz-range-track {
  background: #d1d5db;
  height: 8px;
  border-radius: 4px;
}

.slider::-moz-range-thumb {
  height: 20px;
  width: 20px;
  border-radius: 50%;
  background: #2563eb;
  cursor: pointer;
  border: none;
}

/* Option hover effects */
label:hover input[type="checkbox"],
label:hover input[type="radio"] {
  border-color: #2563eb;
}
</style>
